<!--<link rel="import" href="./components/welfare-report-search.html">-->
<link rel="import" href="./../components/panel-right/panel-right.html">
<link rel="import" href="./../components/page-style.html">
<link rel="import" href="./../components/month-behavior.html">
<link rel="import" href="./components/search-setting.html">
<link rel="import" href="./components/list-employees.html">
<link rel="import" href="./components/employee-manage-add.html">

<link rel="import" href="./../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">

<dom-module id="page-admin-dashboard">
    <template>
        <style include="page-style flex-style">
             :host {
                display: block;
            }

            * {
                font-family: 'CSChatThaiUI', sans-serif;
                -webkit-font-smoothing: antialiased;
            }

            .container {
                padding: 20px;
            }

            paper-material {
                margin: 20px 0px;
            }

            .title {
                font-size: 20px;
                padding: 15px;
            }

            search-setting,
            list-employees {
                /*margin-top: 15px;*/
                width: 98%;
                margin: 10px;
            }

            gl-form-dropdown-menu {
                width: 70%;
            }

            paper-item {
                width: 100%;
            }

            .gl-btn-defalse {
                margin: 0px 15px;
                /*padding: 0px 15px;*/
            }

            vaadin-date-picker {
                margin-top: 0.5px;
            }
            .print{
                margin-top: 15px;
            }
        </style>
        <div class="xcontainer">
            <div class="horizontal justified layout">
                <div class="header-page container">สิทธิสวัสดิการ</div>
                <div style="margin-top:20px;">
                    <paper-button raised class="gl-btn-primary" on-tap="_insertEmployee">
                        <iron-icon icon="add"></iron-icon>เพิ่มพนักงาน
                    </paper-button>
                </div>
            </div>
            <paper-material elevation="1">
                <div class="title">ค้นหา</div>
                <search-setting data="{{data}}"></search-setting>
            </paper-material>

            <paper-material elevation="1">
                <!--<div class="horizontal end-justified layout">
                    <div class="">
                        <gl-form-dropdown-menu always-float-label label="ประเภทรายงาน" placeholder="ประเภทรายงาน" style="margin-top:15px;width:100%;">
                            <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{report_id}}">
                                <template is="dom-repeat" items={{typeReport}}>
                                    <paper-item value="[[item.report_id]]">[[item.report_name]]</paper-item>
                                </template>
                            </paper-menu>
                        </gl-form-dropdown-menu>
                        <gl-form-dropdown-menu always-float-label label="ประเภทรายงาน" placeholder="ประเภทรายงาน" style="margin-top:15px;width:100%;">
                            <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{report_type}}">
                                <template is="dom-repeat" items={{report_type}}>
                                    <paper-item value="[[item.report_type_id]]">[[item.report_type]]</paper-item>
                                </template>
                            </paper-menu>
                        </gl-form-dropdown-menu>
                    </div>
                    <div class="horizontal layout center">
                        <paper-button raised class="gl-btn-defalse" on-tap="_print">
                            <iron-icon icon="print"></iron-icon> ออกรายงาน
                        </paper-button>
                    </div>

                </div>
                <div class="title">รายชื่อพนักงาน</div>-->
                <div class="layout horizontal start-justified">
                    <div class="flex">
                        <div class="title">รายชื่อพนักงาน</div>
                    </div>
                    <div class="flex-2">
                        <div class="horizontal end-justified layout">
                            <div class="flex-3">
                                <gl-form-dropdown-menu always-float-label label="ประเภทรายงาน" placeholder="ประเภทรายงาน" style="margin-top:15px;width:100%;">
                                    <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{report_id}}">
                                        <template is="dom-repeat" items={{typeReport}}>
                                            <paper-item value="[[item.report_id]]">[[item.report_name]]</paper-item>
                                        </template>
                                    </paper-menu>
                                </gl-form-dropdown-menu>
                            </div>
                            <div class="flex" style="margin-left:5px;">
                                <gl-form-dropdown-menu always-float-label label="รูปแบบรายงาน" placeholder="รูปแบบรายงาน" style="margin-top:15px;width:100%;">
                                    <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{report_type_seleted}}">
                                        <template is="dom-repeat" items={{report_type}}>
                                            <paper-item value="[[item.report_type_id]]">[[item.report_type]]</paper-item>
                                        </template>
                                    </paper-menu>
                                </gl-form-dropdown-menu>
                            </div>
                            <div class="flex">
                                <div style="margin:0">
                                    <paper-button raised class="gl-btn-defalse print" on-tap="_print">
                                        <iron-icon icon="print"></iron-icon> ออกรายงาน
                                    </paper-button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <list-employees data-check="{{data}}"></list-employees>
            </paper-material>
        </div>
        <paper-dialog id="report" modal>
            <div class="layout horizontal start-justified">
                <div class="flex" style=" margin-right: 30px">
                    <vaadin-date-picker always-float-label label="วันที่" value="{{data.date_start}}"></vaadin-date-picker>
                </div>
                <div style="margin: 31px 10px;">ถึง</div>
                <div class="flex" style=" margin-right: 30px">
                    <vaadin-date-picker always-float-label label="วันที่" value="{{data.date_end}}"></vaadin-date-picker>
                </div>
            </div>
            <div class="flex horizontal end-justified layout buttons">
                <paper-button raised class="gl-btn-default" dialog-dismiss>ปิด</paper-button>
                <paper-button raised class="gl-btn-primary" on-tap="printReport" dialog-confirm autofocus>ออกรายงาน</paper-button>
            </div>
        </paper-dialog>
        <panel-right id="test" title="{{title}}">

            <employee-manage-add></employee-manage-add>
        </panel-right>
        <!--<welfare-report-search></welfare-report-search>-->
    </template>
    <script>
        Polymer({
            is: 'page-admin-dashboard',
            behaviors: [ReduxBehavior, nylonBehavior, usersAction, userWelfareAction, commonDataAction, MonthBehavior],
            listeners: {
                'back-page': 'changePage',
                'close-panel-right': 'closePanelRight'
            },
            properties: {
                data: {
                    type: Object,

                },
                typeReport: {
                    type: Array,
                    value: [
                        {
                            report_id: 0,
                            report_name: 'รายงาน 1 สรุปยอดรายจ่ายสวัสดิการตามประเภทพนักงาน'
                        },
                        {
                            report_id: 1,
                            report_name: 'รายงาน 2 สรุปยอดรายจ่ายสวัสดิการตามส่วนงาน'
                        },
                        {
                            report_id: 2,
                            report_name: 'รายงาน 3 รายละเอียดการจ่ายเงินสวัสดิการ'
                        },
                        {
                            report_id: 3,
                            report_name: 'รายงาน 4 การเบิกสวัสดิการรายบุคคล'
                        },
                        {
                            report_id: 4,
                            report_name: 'รายงาน 5 สรุปการเบิกสวัสดิการ'
                        },
                        {
                            report_id: 5,
                            report_name: 'รายงาน 6 รายงานการเบิกสวัสดิการ'
                        },
                        {
                            report_id: 6,
                            report_name: 'รายงาน 7 สรุปรายงานการเบิกสวัสดิการตามปีงบประมาณ'
                        },
                        {
                            report_id: 7,
                            report_name: 'รายงาน 8 รายงานการเบิกสวัสดิการตามปีงบประมาณรายบุคคล'
                        },
                    ]
                },
                report_id: {
                    type: Number,
                    value: 0
                },
                report_type: {
                    type: Array,
                    value: [
                        { report_type: 'PDF', report_type_id: 'pdf' },
                        { report_type: 'WORD', report_type_id: 'word' },
                        { report_type: 'EXCEL', report_type_id: 'excel' }
                    ]
                },
                report_type_seleted: {
                    type: Object,
                    value: 'pdf'
                },
                list_welfare: {
                    statePath: 'userWelfare.list_id'
                },
                list_faculty: {
                    statePath: 'commonData.faculty'
                },
                list_type_employee: {
                    statePath: 'commonData.type_employee'
                },
            },
            nylonPageActive: function () {
                // this.TESTS();
                this.WELFARE_LISTS();
                // WELFARE_LIST
                // this.dispatchAction('WELFARE_LIST');
                this.dispatchAction('COMMONDATA_DATA_ACADEMIC');
                // this.dispatchAction('COMMONDATA_DATA_DEPARTMENT');
                this.dispatchAction('COMMONDATA_DATA_ACTIVE');
                this.dispatchAction('COMMONDATA_DATA_FACULTY');
                this.dispatchAction('COMMONDATA_DATA_GENDER');
                this.dispatchAction('COMMONDATA_DATA_MATIER');
                this.dispatchAction('COMMONDATA_DATA_POSITION');
                this.dispatchAction('COMMONDATA_DATA_PREFIXNAME');
                this.dispatchAction('COMMONDATA_DATA_TYPE_EMPLOYEE');
            },
            _insertEmployee: function () {
                this.set('title', 'เพิ่มสมาชิก')
                this.$$('panel-right').open();
                this.CLEAR_INSERT();
            },
            closePanelRight: function () {
                this.$$('panel-right').close();
            },
            _print: function () {
                this.$$('#report').open()

            },
            printReport: function () {
                try {
                    let idReport = this.report_id + 1
                    const getName = (arrays, id) => arrays.find((wel) => wel.id === id)
                    const checkUndefined = (value) => value !== undefined && value !== ''
                    const data = JSON.parse(JSON.stringify(this.data))
                    // data.year = data.year - 543
                    if (checkUndefined(this.data.group_id))
                        data.group_name = getName(this.list_welfare, this.data.group_id).group_welfare_name
                    if (checkUndefined(this.data.faculty_id))
                        data.faculty_name = getName(this.list_faculty, this.data.faculty_id).faculty_name
                    if (checkUndefined(this.data.department_id)) {
                        let department_list = getName(this.list_faculty, this.data.faculty_id).department
                        data.department_name = getName(department_list, data.department_id).department_name
                    }

                    if (checkUndefined(this.data.type_employee_id))
                        data.type_employee_name = getName(this.list_type_employee, this.data.type_employee_id).type_employee_name
                    // //console.log(data.type_employee_name);
                    // //console.log(data);
                    // //console.log(data.department_id);
                    // //console.log(this.genUrl(data));
                    //console.log(this.report_type_seleted);
                    window.open('/api/report/welfare' + idReport + '?' + this.genUrl(data) + '&type=' + this.report_type_seleted);
                    // https://localhost:3000/api/report/welfare1?
                } catch (error) {

                }

            }
        });
    </script>
</dom-module>