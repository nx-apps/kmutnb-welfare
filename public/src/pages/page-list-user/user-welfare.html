<link rel="import" href="./../components/format-number-behavior.html">
<link rel="import" href="./../components/common-logic.html">
<dom-module id="user-welfare">
    <style include="page-style gl-styles gl-size iron-flex iron-flex-factors iron-flex-alignment">
            :host {
                display: block;
            }
            .head-text{
                font-size: var(--font-size-h4);
                margin: 15px 15px 15px 15px;
            }
            table.gl-table-default {
                width: 98%;
                border: 1px solid #ddd;
            /*margin: 15px;*/
            }
            .label,.inpit  {
                font-size: var(--font-size-h5)
            }
            .label {
                text-align: right;
                padding-right: 5px;
            }
            .left {
               text-align: left; 
            }
            fieldset {
                margin: 15px;
            }
        </style>
    <template>
        
        
             <gl-form-panel set-padding="10px 20px 10px 20px" set-border="1px">
                <gl-form-panel-head label="" set-padding="10px" set-border="1px">
                    <paper-button class="gl-btn-info" on-tap="editData" raised>แก้ไขข้อมูลพนักงาน</paper-button>
                </gl-form-panel-head>
                <gl-form-panel-body label="" set-padding="10px" set-border="1px">
                    <fieldset>
                        <legend>ข้อมูลพนักงาน :</legend>
                        <div class="flex content horizontal start-justified layout">
                                <div class="flex">ชื่อ : [[data.prefixname_name]] [[data.name]] [[data.surname]]</div>
                                <div class="flex">รหัสพนักงาน : [[data.emp_id]]</div>
                        </div>
                        <div class="flex content horizontal start-justified layout">
                                <div class="flex">สถานภาพการทำงาน : [[data.active_name]]</div>
                                <div class="flex">ตำแหน่ง : [[data.position_name]]</div>
                        </div>
                        <div class="flex content horizontal start-justified layout">
                                <div class="flex">ภาควิชา : [[data.department_name]]</div>
                                <div class="flex">คณะ : [[data.faculty_name]]</div>
                        </div>
                    </fieldset>
                </gl-form-panel-body>

 <gl-form-panel-body label="" set-padding="10px" set-border="1px">
                 <div class="head-text">
             สวัสดิการที่ได้รับสิทธิ์
            </div>
                <div class="content horizontal center-justified layout">
                    <table class="gl-table-default">
                        <thead class="table-head">
                            <tr>
                                <th style="width: 5%">ลำดับ</th>
                                <th style="width: 50%">ชื่อสวัสดิการที่สามารถใช้งานได้</th>
                                <th style="width: 30%">จำนวนเงินคงเหลือ</th>
                                <th style="width: 15%">ขอใช้</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">
                            
                            <template is="dom-repeat" items={{data.welfare}} >
                                <tr>
                                    <td>[[_Obindex(index)]]</td>
                                    <td>[[item.name]]</td>
                                    <td>[[formatNumber(item.budget_balance)]]</td>
                                    <td> <paper-button class="gl-btn-primary gl-small"raised on-tap="useWalfare" data="[[item]]">ขอใช้</paper-button></td>
                                </tr>
                            </template>
                            <template is="dom-if" if={{_ObIsHave(data.welfare)}}>
                                <tr>
                                    <td colspan="4" style="text-align: center">ไม่มีข้อมูล</td>
                                </tr>
                            </template>
                            
                        </tbody>
                    </table>
            </div>

            </gl-form-panel-body>
             <gl-form-panel-body label="" set-padding="10px" set-border="1px">
                 <div class="head-text">
             สวัสดิการที่ได้ใช้สิทธิ์ไปแล้ว
            </div>
                <div class="content horizontal center-justified layout">
                    <table class="gl-table-default">
                        <thead class="table-head">
                            <tr>
                                <th style="width: 5%">ลำดับ</th>
                                <th style="width: 30%">ชื่อสวัสดิการที่สามารถใช้งานได้</th>
                                <th style="width: 30%">จำนวนเงินที่ใช้</th>
                                <th style="width: 30%">วันที่ใช้งาน</th>
                                <th style="width: 10%">กระทำการ</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">
                            <template is="dom-repeat" items={{data.history_welfare}} >
                                <tr>
                                    <td>[[_Obindex(index)]]</td>
                                    <td>[[item.name]]</td>
                                    <td>[[formatNumber(item.use_budget)]]</td>
                                    <td>
                                        <vaadin-date-picker always-float-label  disabled value="{{item.date_use}}"></vaadin-date-picker>
                                    </td>
                                    <td> <paper-button class="gl-btn-danger gl-small"raised on-tap="deleteHistoryWelfare" data="[[item]]">ลบ</paper-button></td>
                                </tr>
                            </template>
                            <template is="dom-if" if={{_ObIsHave(data.history_welfare)}}>
                                <tr>
                                    <td colspan="5" style="text-align: center">ไม่มีข้อมูล</td>
                                </tr>
                            </template>
                         </tbody>
                    </table>
            </div>

            </gl-form-panel-body>
                <!--<gl-form-panel-footer label="Footer" set-padding="10px">
                
                </gl-form-panel-footer>-->
            </gl-form-panel>
        <!--</paper-material>-->
<paper-dialog id="walfare_budget" >
         <div class="flex">
             <h2 id="walfare_name">Dialog Title</h2>
        </div>
        <div class="flex horizontal start-justified layout">
            <div class="flex-2 label">
                <label for="total_budget">จำนวนเงินคงเหลือ :</label>
            </div>
            <div class="flex-2">
                 <gl-form-input id="total_budget" no-label-float disabled format-number="on" value="[[dataSelete.budget]]">
                     <div suffix>บาท</div>
                 </gl-form-input>
            </div> 
            <div class="flex label">
                <label for="emp_id">ใช้จำนวน :</label>
            </div>
            <div class="flex-2">
                [[changeString2Num(useWalfareProp.*,'use_budget')]]
                [[checkBudget(useWalfareProp.*)]]
                 <gl-form-input id="emp_id" no-label-float allowed-pattern="[0-9||,||.]" format-number="on" value="{{useWalfareProp.use_budget}}"  ><div suffix>บาท</div></gl-form-input>
            </div> 
        </div>
        <div class="flex horizontal start-justified layout">
            <div class="flex-2 label">
                <label for="total_budget">วันที่ใช้งาน :</label>
            </div>
            <div class="flex-2">
                 <vaadin-date-picker always-float-label  value="{{useWalfareProp.date_use}}"></vaadin-date-picker>
                 </gl-form-input>
            </div> 
            <div class="flex label">
                <!--<label for="emp_id">ใช้จำนวน :</label>-->
            </div>
            <div class="flex-2">
            </div> 
        </div>
        <div class="flex horizontal start-justified layout">
            *ใช้เงินได้มากสุดตามจำนวนที่คงเหลือ
        </div>
        <div class="flex horizontal end-justified layout">
            <paper-button raised class="gl-btn-primary" on-tap="getWalfare">ใช้งาน</paper-button>
        </div>
</paper-dialog>
        
    </template>
    <script>
        Polymer({
            is: 'user-welfare',
            behaviors:[ReduxBehavior,FormatNumberBehavior,commonLogic],
            properties:{
                data:{
                    statePath:'users.select_welefares'
                },
                useWalfareProp:{
                    type:Object,
                    value:{}
                },
                dataSelete:{
                    type:Object,
                    value:{budget:0}
                },
            },
            editData(){
                this.fire('_get-user-edit',this.data)
                // this.dispatchAction('USER_SELECT',e.detail);
            },
            _Obindex(index){
                return index+1
            },
            useWalfare(e){
                // console.log(this.data.id);
                // console.log(e.currentTarget.data);
                this.set('useWalfareProp.emp_id',this.data.id)
                this.set('useWalfareProp.welfare_id',e.currentTarget.data.welfare_id)
                this.$$('#walfare_budget').open()
                // console.log(this.$$('#walfare_name').innerHTML=e.currentTarget.data.name);
                this.set('dataSelete.budget',e.currentTarget.data.budget)
                // this.$$('#total_budget').value=this.formatNumber(e.currentTarget.data.budget)
            },
            getWalfare(){
                // console.log(this.useWalfareProp);
                this.$$('#walfare_budget').close()
                this.dispatchAction('USER_USE_WELFARE',this.useWalfareProp);
                
            },
            checkBudget(e){
                try {
                        if(this.useWalfareProp.use_budget > this.dataSelete.budget)
                            this.set('useWalfareProp.use_budget',this.dataSelete.budget)
                            // console.log(this.useWalfareProp.use_budget);
                            //  console.log(this.dataSelete.budget);
                    }
                    catch(err) {
                        // document.getElementById("demo").innerHTML = err.message;
                    } 
            },
            deleteHistoryWelfare(e){
                console.log(e.currentTarget.data);
                this.dispatchAction('USER_DELETE_USE_WELFARE',e.currentTarget.data);
            }
        });
    </script>
</dom-module>
