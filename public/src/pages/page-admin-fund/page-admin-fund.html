<link rel="import" href="components/fund-form.html">
<!--<link rel="import" href="components/fund-manage.html">-->
<link rel="import" href="./../components/format-number-behavior.html">

<dom-module id="page-admin-fund">
    <template>
        <style include="gl-styles gl-table flex-style">
            paper-material {
                padding: 0px;
                background-color: white;
            }
            th,td{
                text-align: center;
            }
            .container{
        	    margin:auto;
      	    }
            .header{
                padding: 20px 0px 20px 0px;
                font-size: 22px;
            }
            @media screen and (min-width: 1275px) {
                .container {
                    width:80%;
                }
    	    } 
            .table-detail {
                margin: auto;
            }
            table.gl-table-default {
                width: 100%;
                border: 1px solid #ddd;
            }
        </style>
        <div class="container">
            <div class="header">
                จัดการกองทุน : สำรองเลี้ยงชีพ
            </div>
            <div class="flex-end-justified">
                <div>
                    <paper-button class="gl-btn-primary" on-tap="add" raised>
                        <iron-icon icon="add"></iron-icon> เพิ่มกองทุน                        
                    </paper-button>
                </div>
            </div>
            <div class="table-detail">
                <paper-material elevation="1">
                    <table class="gl-table-default">
                        <thead class="table-head">
                            <tr>
                                <th style="text-align:center;">#</th>
                                <th>ชื่อนโยบาย</th>
                                <th style="text-align:center">จำนวนสมาชิก</th>
                                <th style="text-align:center">มูลค่าต่อหน่วย</th>
                                <th style="text-align:center">ผลตอบแทน</th>
                                <th style="text-align:center">มูลค่าทรัพสิน</th>
                                <th style="text-align:center; width: 15%;">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">  
                            <template is="dom-if" if="{{checkDataList(dataList)}}">
                                <tr>
                                    <td colspan="7">ไม่พบข้อมูล</td>
                                </tr>
                             </template>
                            <template is="dom-repeat" items="{{dataList}}">
                                <tr style="cursor:pointer;">
                                    <td style="text-align:center">[[cont(index)]]</td>
                                    <td>[[item.rvd_name]]</td>
                                    <td style="text-align:center">[[item.count_emp]]</td>
                                    <td style="text-align:center">[[item.unit_value]]</td>
                                    <td style="text-align:center">[[item.reward]]</td>
                                    <td style="text-align:center">[[item.property_value]]</td>
                                    <td style="text-align:center">
                                        <paper-icon-button icon="create" id="[[item.id]]" on-tap="edit"></paper-icon-button>
                                        <paper-icon-button icon="delete" id="[[item.id]]" on-tap="confirmDelete"></paper-icon-button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </paper-material>
            </div>
        </div>
        <panel-right title="{{title}}">
            <section>
                <fund-form></fund-form>
            </section>
        </panel-right>
    </template>
    <script>
        Polymer({
            is: 'page-admin-fund',
            behaviors: [ReduxBehavior,FormatNumberBehavior,fundRvdAction,nylonBehavior],
            properties:{
                dataList:{
                    statePath: 'fundRvd.dataList'
                }
            },
            listeners:{
                  'close':'closePanelRight'
            },
            nylonPageActive:function(){
                this.FUND_RVD_GET_LIST();
            },
            cont:function(index){
                return parseInt(index) +1;
            },
            ready:function(){
                this.fundForm = this.$$('fund-form');
                this.panelRight = this.$$('panel-right');
            },
            checkDataList:function(data){
                if(data.length == 0){
                    return true;
                }
                else{
                    return false;
                }
            },  
            add:function(){
                this.fundForm.resetComponents();
                this.fundForm.editForm = false;
                this.FUND_RVD_CLEAR_DATA();
                this.panelRight.open();
            },
            confirmDelete:function(e){
                var id = e.target.id;
                this.fire('toast',{ 
                    status:'openDialog',
                    text:'ต้องการลบข้อมูลใช่หรือไม่ ?',
                    confirmed:this.deleteData.bind(this),
                    data:id 
                })
            },
            deleteData:function(check,data){
                if(check == true){
                //   console.log(data.data);
                  var id = data.data;
                  this.FUND_RVD_DELETE(id)
                }
            },
            edit:function(e){
                var id = e.target.id;
                this.FUND_RVD_SELECT(id);
            },
            closePanelRight:function(){
                this.panelRight.close();
            }
        });
    </script>
</dom-module>