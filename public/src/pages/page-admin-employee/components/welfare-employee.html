<link rel="import" href="../../components/format-number-behavior.html">
<link rel="import" href="../../components/common-logic.html">
<link rel="import" href="../components/dialog-use-welfare.html">
<dom-module id="welfare-employee">
    <style include="page-style gl-styles gl-size iron-flex iron-flex-factors iron-flex-alignment">
         :host {
            display: block;
        }
        
        .head-text {
            font-size: var(--font-size-h4);
            margin: 15px 15px 15px 15px;
        }
        
        table.gl-table-default {
            width: 98%;
            border: 1px solid #ddd;
            /*margin: 15px;*/
        }
        
        .label,
        .inpit {
            font-size: var(--font-size-h5)
        }
        
        .label {
            text-align: right;
            padding-right: 5px;
        }
        
        .left {
            text-align: left;
        }
        
        .right {
            text-align: right;
        }
        
        fieldset {
            margin: 15px;
        }
    </style>
    <template>

        <gl-form-panel set-padding="10px 20px 10px 20px" set-border="1px">
            <gl-form-panel-head label="" set-padding="10px" set-border="1px">
                <paper-button on-tap="back" raised>back</paper-button>
                <paper-button class="gl-btn-info" on-tap="editData" raised>แก้ไขข้อมูลพนักงาน</paper-button>
            </gl-form-panel-head>
            <gl-form-panel-body label="" set-padding="10px" set-border="1px">
                <fieldset>
                    <legend>ข้อมูลพนักงาน :</legend>
                    <div class="flex content horizontal start-justified layout">
                        <div class="flex">ชื่อ : [[data.prefix_name]] [[data.firstname]] [[data.lastname]]</div>
                        <div class="flex">รหัสพนักงาน : [[data.emp_no]]</div>
                    </div>
                    <div class="flex content horizontal start-justified layout">
                        <div class="flex">สถานภาพการทำงาน : [[data.active_name]]</div>
                        <div class="flex">ตำแหน่ง : [[data.position_name]]</div>
                    </div>
                    <div class="flex content horizontal start-justified layout">
                        <div class="flex">ภาควิชา : [[data.department_name]]</div>
                        <div class="flex">คณะ : [[data.faculty_name]]</div>
                    </div>
                </fieldset>
                <div class="content horizontal start-justified layout">
                    [[setYear(year)]]
                    <gl-combo-box no-label-float items="{{year}}" value="{{seleterYear}}" item-label-path="year" item-value-path="year" on-value-changed="gerYearWelfare"></gl-combo-box>
                </div>
            </gl-form-panel-body>

            <gl-form-panel-body label="" set-padding="10px" set-border="1px">
                <div class="head-text">
                    สวัสดิการที่ได้รับสิทธิ์
                </div>
                <div class="content horizontal center-justified layout">
                    <table class="gl-table-default">
                        <thead class="table-head">
                            <tr>
                                <th style="width: 5%">ลำดับ</th>
                                <th style="width: 40%">สวัสดิการที่สามารถใช้ได้</th>
                                <th style="width: 15%">จำนวนเงินที่ได้</th>
                                <th style="width: 15%">จำนวนเงินที่ใช้ไปแล้ว</th>
                                <th style="width: 15%">จำนวนเงินที่คงเหลือ</th>
                                <th style="width: 15%">ขอใช้</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">

                            <template is="dom-repeat" items={{data.welfare}}>
                                <tr>
                                    <td>[[_Obindex(index)]]</td>
                                    <td>[[item.group_welfare_name]]</td>
                                    <td style="text-align: right;">[[formatNumber(item.budget)]]</td>
                                    <td style="text-align: right;">[[formatNumber(item.budget_use)]]</td>
                                    <td style="text-align: right;">[[formatNumber(item.budget_balance)]]</td>
                                    <td>
                                        <paper-button class="gl-btn-primary gl-small" raised on-tap="usewelfare" data="[[item]]" disabled="[[_checkAdmin(item.status_approve,item.admin_use)]]">ใช้</paper-button>
                                    </td>
                                </tr>
                            </template>
                            <template is="dom-if" if={{_ObIsHave(data.welfare)}}>
                                <tr>
                                    <td colspan="4" style="text-align: center">ไม่มีข้อมูล</td>
                                </tr>
                            </template>

                        </tbody>
                    </table>
                </div>

            </gl-form-panel-body>
            <gl-form-panel-body label="" set-padding="10px" set-border="1px">
                <div class="head-text">
                    สวัสดิการที่ได้ใช้สิทธิ์ไปแล้ว
                </div>
                <div class="content horizontal center-justified layout">
                    <table class="gl-table-default">
                        <thead class="table-head">
                            <tr>
                                <th style="width: 10%">ลำดับ</th>
                                <th style="width: 40%">สวัสดิการที่ใช้</th>
                                <th style="width: 15%;text-align: right;">จำนวนเงินที่ใช้</th>
                                <th style="width: 15%">วันที่ขอใช้งาน</th>
                                <th style="width: 20%">วันที่อนุมัติ</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">
                            <template is="dom-repeat" items={{data.history_welfare}}>
                                <tr>
                                    <td>[[_Obindex(index)]]</td>
                                    <td>[[item.name]]</td>
                                    <td>[[formatNumber(item.use_budget)]]</td>
                                    <td>
                                        <vaadin-date-picker always-float-label disabled value="{{item.date_use}}"></vaadin-date-picker>
                                    </td>
                                    <td>
                                        <vaadin-date-picker always-float-label disabled value="{{item.date_approve}}"></vaadin-date-picker>

                                    </td>
                                </tr>
                            </template>
                            <template is="dom-if" if={{_ObIsHave(data.history_welfare)}}>
                                <tr>
                                    <td colspan="5" style="text-align: center">ไม่มีข้อมูล</td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>

            </gl-form-panel-body>
            <!--<gl-form-panel-footer label="Footer" set-padding="10px">
                
                </gl-form-panel-footer>-->
        </gl-form-panel>
        <paper-dialog id="welfare_budget">
            <dialog-use-welfare data="{{usewelfareProp}}" disabled="[[disabled]]"></dialog-use-welfare>
            <div class="flex horizontal end-justified layout">
                <paper-button raised class="gl-btn-primary" on-tap="getwelfare">ใช้งาน</paper-button>
            </div>
        </paper-dialog>

    </template>
    <script>
        Polymer({
            is: 'welfare-employee',
            behaviors: [ReduxBehavior, FormatNumberBehavior, commonLogic],
            properties: {
                data: {
                    statePath: 'userWelfare.welfare_employee'
                },
                year :{
                    statePath:'userWelfare.list',
                    type:Number,
                }
            },
            setYear(year){
                try {
                    this.set('seleterYear',year[year.length-1].year)
                    // console.log(year[year.length-1].year);
                // console.log(this.seleterYear);
                } catch (error) {
                    
                }
            },        
            gerYearWelfare(e){
                if(typeof this.data != 'undefined' ){
                    // console.log(this.data);
                    if (e.detail.value)
                        var id = this.data.id;
                        if(typeof id != 'undefined' ){
                            this.dispatchAction('EMPLOYEE_GET_WELFARES',id,e.detail.value-543);
                        }
                }
            },
            _checkAdmin(status_user,status_admin){
                // (status_admin || status_user ? {return true} : false)
                if (status_admin || status_user) 
                   return true
            },
            back:function(){
                // console.log(55);
                this.fire('select-page',0)
            },
            usewelfare:function(){
                this.$$('#welfare_budget').open()
            }
        });
    </script>
</dom-module>