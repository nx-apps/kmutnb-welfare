<link rel="import" href="components/list-welfare.html">
<link rel="import" href="components/welfare-employee.html">
<link rel="import" href="components/employee-manage.html">
<link rel="import" href="./components/admin-list-user.html">

<link rel="import" href="./../components/page-style.html">

<dom-module id="page-admin-employee">
    <style is="custom-style" include="page-style iron-flex iron-flex-factors iron-flex-alignment gl-styles">
        /*paper-material {
            background-color: var(--gl-white-color);
        }*/
        
        * {
            font-family: 'CSChatThaiUI', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            padding: 20px;
        }
        
        
        /*.table-detail {
            margin: auto;
            width: 70%;
        }
        .serachBox{
            margin: auto;
            width: 70%;
        }
        table.gl-table-default {
            border: 1px solid #ddd;
        }
        .btn-insert{
            margin-right: 10px;
            background-color: deepskyblue;
            color: white;
        }*/
    </style>
    <template>
        <div class="xcontainer">
            <iron-pages selected="{{selected}}">
                <section>
                    <div class="header-page container">
                        จัดการข้อมูลพนักงาน
                    </div>
                    <div class="container">
                        <paper-material elevation="1">
                            <div>
                                <div class="layout horizontal">
                                    <div class="flex"></div>
                                    <div class="flex-3">
                                        <gl-combo-box label="ปี" placeholder="มีทั้งหมด {{year.length}} ปี" items="{{year}}" item-label-path="year" item-value-path="year"
                                            value="{{selectYear}}">
                                        </gl-combo-box>
                                    </div>
                                    <div class="flex"></div>
                                    <div class="flex-3">
                                        <gl-form-dropdown-menu style="width: 100%" label="สวัสดิการ" placeholder="มีสวัสดิการ {{listWelfare.length}} รายการ">
                                            <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{selectWelfare}}">
                                                <template is="dom-repeat" items="{{listWelfare}}">
                                                    <paper-item value="{{item.id}}">{{item.group_welfare_name}}</paper-item>
                                                </template>
                                            </paper-listbox>
                                        </gl-form-dropdown-menu>
                                    </div>
                                    <div class="flex"></div>
                                </div>

                                <div class="layout horizontal">
                                    <div class="flex"></div>
                                    <div class="flex-3">
                                        <gl-combo-box label="เลือกคณะ" placeholder="มีทั้งหมด {{listFaculty.length}} คณะ" items="{{listFaculty}}" item-label-path="faculty_name"
                                            item-value-path="id" value="{{selectType}}">
                                        </gl-combo-box>
                                    </div>
                                    <div class="flex"></div>
                                    <div class="flex-3">
                                        <gl-form-dropdown-menu style="width: 100%" label="ภาควิชา" placeholder="มีภาควิชา {{departmentList.length}} ภาควิชา">
                                            <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{selectDepartment}}">
                                                <template is="dom-repeat" items="{{departmentList}}">
                                                    <paper-item value="{{item.id}}">{{item.department_name}}</paper-item>
                                                </template>
                                            </paper-listbox>
                                        </gl-form-dropdown-menu>
                                    </div>
                                    <div class="flex"></div>
                                </div>
                            </div>

                        </paper-material>

                    </div>

                    <div class="horizontal end-justified layout">
                        <paper-button raised class="gl-bg-primary" on-tap="_insert">
                            <iron-icon icon="add"></iron-icon>เพิ่มพนักงาน
                        </paper-button>
                    </div>


                    <div>
                        <admin-list-user></admin-list-user>
                    </div>
                </section>
                <section>
                    <!--pages-->
                    <welfare-employee></welfare-employee>
                </section>
                <section>
                    <!--pages-->
                    <!--1212121-->
                    <div>
                        111111
                    </div>
                    <employee-manage></employee-manage>
                </section>

            </iron-pages>
            <panel-right id="test" title="{{title}}">
                <employee-manage></employee-manage>
                <!--<user-panel class="sub-component" data="[[dataSelete]]"></user-panel>-->
            </panel-right>

        </div>
    </template>
    <script>
        Polymer({
            is: 'page-admin-employee',
            behaviors: [ReduxBehavior, nylonBehavior, userWelfareAction, uploadAction, commonDataAction],
            observers: [
                'select_year(selectYear)',
                'select_welfare(selectWelfare)',
                'select_faculty(selectType)',
                'select_department(selectDepartment)'
            ],
            properties: {
                year: {
                    statePath: 'userWelfare.list'
                },
                listWelfare: {
                    statePath: 'userWelfare.list_id'
                },
                listFaculty: {
                    statePath: 'userWelfare.faculty_list'
                },
                typeSerach: {
                    type: Array,
                    value: [
                        {
                            label: 'ชื่อ',
                            value: 'name'
                        },
                        {
                            label: 'รหัสพนักงาน',
                            value: 'no'
                        },
                        {
                            label: 'ตำแหน่ง',
                            value: 'position'
                        },
                        {
                            label: 'ตำแหน่งวิชาการ',
                            value: 'SubPosition'
                        },
                    ]
                }
            },
            listeners: {
                'back_page': 'back_page',
                'select-page': 'changePage',
                'reset-search': 'resetSearch'
            },
            ready: function () {
                this._getcommon();
            },
            resetSearch: function () {
                this.selectYear = "";
                this.selectWelfare = "";
                this.selectType = "";
                this.selectDepartment = "";
                this.$$('admin-list-user').selectTable(true);
                this.FACULTY_LIST();
                this.LIST_USER("");
            },
            nylonPageActive: function () {
                this.selected = 0;
                this.WELFARE_LIST_YEAR();
                this.LIST_USER("");
                this.$$('admin-list-user').selectTable(true)
                this.FACULTY_LIST();
            },
            select_year: function (year) {
                if (year != "") {
                    this.selectWelfare = "";
                    var newYear = parseInt(year) - 543;
                    this.WELFARE_LIST(newYear);
                }
            },
            select_welfare: function (id) {
                if (id != "") {
                    this.selectType = "";
                    this.selectDepartment = "";
                    var getid = id;
                    var dataFilter = this.listWelfare.filter((item) => {
                        return item.id == id;
                    })
                    var getStatus;
                    dataFilter.map((item) => {
                        getStatus = item.admin_use;
                    })
                    console.log(getStatus);
                    this.$$('admin-list-user').checkBox = getStatus;
                    // if(id != ""){
                    this.$$('admin-list-user').selectTable(false)
                    this.LIST_USER_SERARCH(id);
                }
            },
            select_faculty: function (id) {
                if (id != '' || typeof id == 'undefined') {
                    // console.log('id',id);
                    this.selectDepartment = "";
                    var newItem = this.listFaculty.filter((item) => {
                        return id == item.id
                    })
                    this.departmentList = []
                    newItem.map((item) => {
                        this.departmentList = item.department;
                    })
                    this.$$('admin-list-user').searchTableByFilterFaculty(id);
                    // console.log(this.departmentList);
                }
            },
            select_department: function (id) {
                console.log('*', id);
                this.$$('admin-list-user').searchTableByFilterDepartment(id);
            },
            back_page: function () {
                this.pages = 0;
            },
            confirmSend: function () {
                this.fire('toast', {
                    status: 'openDialog',
                    text: 'ต้องการอนุมัติข้อมูลใช่หรือไม่ ?',
                    confirmed: this.sendUser.bind(this),
                })
            },
            sendUser: function (check) {
                if (check == true)
                    this.$$('admin-list-user').insertData();
            },
            changePage: function (page) {
                // console.log(page.detail.data);
                if (page.detail != 0) {
                    this.selected = page.detail;
                    this.$$('welfare-employee').pages = 0;
                }
                else {
                    this.selected = page.detail;
                }
            },
            _insert: function () {
                // this.selected = 2;
                this.set('title', 'เพิ่มสมาชิก')
                this.$$('panel-right').open();
            },
            _getcommon: function () {
                this.dispatchAction('COMMONDATA_DATA_ACADEMIC');
                this.dispatchAction('COMMONDATA_DATA_DEPARTMENT');
                this.dispatchAction('COMMONDATA_DATA_ACTIVE');
                this.dispatchAction('COMMONDATA_DATA_FACULTY');
                this.dispatchAction('COMMONDATA_DATA_GENDER');
                this.dispatchAction('COMMONDATA_DATA_MATIER');
                this.dispatchAction('COMMONDATA_DATA_POSITION');
                this.dispatchAction('COMMONDATA_DATA_PREFIXNAME');
                this.dispatchAction('COMMONDATA_DATA_TYPE_EMPLOYEE');
            }
        });
    </script>
</dom-module>