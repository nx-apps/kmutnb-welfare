<link rel="import" href="components/list-welfare.html">
<link rel="import" href="./components/list-user.html">

<dom-module id="page-admin-employee">
    <style is="custom-style" include="gl-color gl-table flex-style">
        paper-material {
            background-color: var(--gl-white-color);
        }
        .container{
            padding: 20px;
        }
        .table-detail {
            margin: auto;
            width: 70%;
        }
        .serachBox{
            margin: auto;
            width: 70%;
        }
        table.gl-table-default {
            border: 1px solid #ddd;
        }
         paper-fab {
                position: fixed;
                right: 25px;
                bottom: 25px;
                color: #fff;
                --paper-fab-background:var(--paper-light-blue-500);
                --paper-fab-keyboard-focus-background: var(--paper-light-blue-900);
        }
    </style>
    <template>
        <div class="container serachBox">
            <paper-material elevation="1">
                <div style="padding: 10px">
                    <div class="container flex-horizontal-with-ratios">
                        <div class="flexchild"></div>
                        <div class="flex3child">
                            <gl-combo-box label="ปี" placeholder="มีทั้งหมด {{year.length}} ปี" items="{{year}}" item-label-path="year" item-value-path="year" value="{{selectYear}}">
                            </gl-combo-box>
                        </div>
                        <div class="flexchild"></div>
                        <div class="flex3child">
                            <gl-combo-box label="สวัสดิการ" placeholder="มีสวัสดิการทั้งหมด {{listWelfare.length}} รายการ" items="{{listWelfare}}" item-label-path="group_welfare_name" item-value-path="id" value="{{selectWelfare}}"></gl-combo-box>
                        </div>
                        <div class="flexchild"></div>
                    </div>
                </div>
            </paper-material>
        </div>
        <section>
            <list-user></list-user>
        </section>
        <paper-fab icon="send" on-tap="confirmSend"></paper-fab>
        
    </template>
    <script>
        Polymer({
            is: 'page-admin-employee',
            behaviors: [ReduxBehavior, nylonBehavior, userWelfareAction],
            observers:['select_year(selectYear)','select_welfare(selectWelfare)'],
            properties: {
                year: {
                    statePath: 'userWelfare.list'
                },
                listWelfare:{
                    statePath: 'userWelfare.list_id'
                }
            },
            listeners:{
                'back_page' : 'back_page'
            },
            nylonPageActive: function () {
                this.WELFARE_LIST_YEAR();
                this.LIST_USER("");
                this.$$('list-user').selectTable(true)
            },
            select_year:function(year) {
                // alert(year)
               if(year != ""){
                   this.selectWelfare = "";
                   var newYear = parseInt(year)-543;
                   this.WELFARE_LIST(newYear);
               }
            },
            select_welfare:function(id){
                 if(id != ""){
                    var getid = id;
                    var dataFilter = this.listWelfare.filter((item)=>{
                        return item.id == id;
                    })
                    var getStatus;
                    dataFilter.map((item)=>{
                        getStatus = item.admin_use;
                    })
                    console.log(getStatus);
                    this.$$('list-user').checkBox = getStatus;
                // if(id != ""){
                    this.$$('list-user').selectTable(false)
                    this.LIST_USER_SERARCH(id);
                }
            },
            back_page:function(){
                this.pages = 0;
            },
            confirmSend:function(){
                this.fire('toast',{ 
                 status:'openDialog',
                 text:'ต้องการอนุมัติข้อมูลใช่หรือไม่ ?',
                 confirmed:this.sendUser.bind(this), 
                 })
            },
            sendUser:function(check){
                if(check == true)
                    this.$$('list-user').insertData();
            }
        });
    </script>
</dom-module>