<link rel="import" href="./../../components/common-logic.html">

<link rel="import" href="./../../components/month-behavior.html">
<dom-module id="fund-rvd">
    <template>
        <style include="page-style  gl-size iron-flex iron-flex-factors iron-flex-alignment">
             :host {
                display: block;
            }
        </style>
        <template is="dom-if" if={{!_ObIsHave(data)}}>
            <table class="gl-table-default">
                <thead class="table-head">
                    <tr>
                        <th>ลำดับ</th>
                        <th>ชื่อ</th>
                        <th>รายละเอียด</th>
                        <th>วันที่สมัคร</th>
                        <th>กระทำการ</th>
                    </tr>
                </thead>
                <tbody class="table-body">
                    <!-- ชื่อที่สมัคร -->
                    <!--<template is="dom-if" if={{_ObIsHave(data.history_welfare)}}>-->
                    <template is="dom-repeat" items={{data}}>
                        <tr>
                            <td>[[_Obindex(index)]]</td>
                            <td>[[item.rvd_name]]</td>
                            <td>[[item.description]]</td>
                            <td>[[toThaiDate(item.date_signup)]]</td>
                            <td>
                                <paper-button raised class="gl-btn-info" data="[[item]]" on-tap="fundOut">ออกจากกองทุน</paper-button>
                                <paper-button raised class="gl-btn-danger"  data="[[item]]"on-tap="leaveWork">ลาออก</paper-button>
                            </td>
                        </tr>
                    </template>
                    <!--</template>-->

                </tbody>
            </table>
        </template>
        <template is="dom-if" if={{_ObIsHave(data)}}>
            <table class="gl-table-default">
                <thead class="table-head">
                    <tr>
                        <th>ลำดับ</th>
                        <th>ชื่อ</th>
                        <th>รายละเอียด</th>
                        <th>กระทำการ</th>
                    </tr>
                </thead>
                <tbody class="table-body">
                    <template is="dom-repeat" items={{forRegrvp}}>
                        <tr>
                            <td>[[_Obindex(index)]]</td>
                            <td>[[item.rvd_name]]</td>
                            <td>[[item.description]]</td>
                            <td>
                                <paper-button class="gl-btn-primary" data="[[item]]" on-tap="regFund" raised>สมัคร</paper-button>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </template>


    </template>
    <script>
        Polymer({
            is: 'fund-rvd',
            behaviors: [ReduxBehavior, commonLogic, MonthBehavior],
            properties: {
                data: {
                    statePath: 'users.rvp_fund',
                },
                forRegrvp: {
                    statePath: 'fundRvd.dataList',
                },
            },
            regFund(e) {
                console.log(this.personalId);
                console.log(e.currentTarget.data.id);
                let obj = {
                    personal_id: this.personalId,
                    rvd_id: e.currentTarget.data.id
                }
                this.dispatchAction('USER_RVP_SIGNUP', obj);

                this.dispatchAction('USER_RVP_FUND', this.personalId);
                // this.dispatchAction('USER_RVP_SIGNUP',obj)
                // this.set('fundSeleted',e.currentTarget.id)
            },
            leaveWork(e){
                console.log(e.currentTarget.data.id);
                let obj = {
                    id:e.currentTarget.data.id
                }
                this.dispatchAction('USER_RVP_LEAVE_FUND', obj);
                this.dispatchAction('USER_RVP_FUND', this.personalId);
            },
            fundOut(e){
                console.log(e.currentTarget.data.id);
                let obj = {
                    id:e.currentTarget.data.id
                }
                this.dispatchAction('USER_RVP_FUND_OUT', obj);
                this.dispatchAction('USER_RVP_FUND', this.personalId);
            }
        });
    </script>
</dom-module>