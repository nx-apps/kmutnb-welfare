<link rel="import" href="../components/card-search.html">
<link rel="import" href="../components/page-style.html">
<link rel="import" href="../components/month-behavior.html">
<dom-module id="page-report-year">
    <style include="page-style iron-flex iron-flex-factors iron-flex-alignment">
        paper-item {
            width: 150px;
        }
    </style>
    <template>
        <div class="layout horizontal center-justified wrap">
            <card-search>
                <div class="title-head">
                    รายงานของปี
                </div>
                <div class="layout horizontal center-justified">
                    <div class="menu">
                        เลือกปี
                    </div>
                    [[changeYears(selectYear)]]
                    <div class="layout horizontal center-justified">
                        <gl-form-dropdown-menu style="margin-top:15px;width:100%;">
                            <paper-listbox class="dropdown-content" attr-for-selected="value" selected="{{selectYear}}">
                                <template is="dom-repeat" items="{{list_year}}">
                                    <paper-item value="{{item.year}}">{{item.year}}</paper-item>
                                </template>
                            </paper-listbox>
                        </gl-form-dropdown-menu>
                    </div>
                </div>
                <div class="layout horizontal center-justified">
                    <div class="menu">
                        เลือกสวัสดิการ
                    </div>
                    <div class="layout horizontal center-justified">
                        <gl-form-dropdown-menu placeholder="เลือกสวัสดิการ" style="margin-top:15px;">
                            <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{group_id}}">
                                <paper-item value="">ทั้งหมด</paper-item>
                                <template is="dom-repeat" items={{list}}>
                                    <paper-item value="[[item.id]]">[[item.group_welfare_name]]</paper-item>
                                </template>
                            </paper-menu>
                        </gl-form-dropdown-menu>
                    </div>
                </div>
                
                <paper-button class="gl-btn-info" on-tap="print">Print</paper-button>
                
            </card-search>
        </div>
    </template>
    <script>
        Polymer({
            is: 'page-report-year',
            behaviors: [ReduxBehavior, nylonBehavior, groupWelfareAction, MonthBehavior],
            properties: {
                list: {
                    statePath: 'groupWelfare.list'
                },
                list_year: {
                    statePath: 'groupWelfare.list_year'
                },
                group_id:{
                    type:Number,
                    value:0
                }
            },
            nylonPageActive: function () {
                let year = new Date().getFullYear();
                var newYear = year + 543;
                this.selectYear = newYear;
                this.GET_YEAR();
            },
            changeYears: function (year) {
                if(typeof year != 'undefined' && year != undefined){
                    var changeYear = year - 543;
                    this.LIST_WELFARE(changeYear);
                }
            },
            print:function(){
                var select = {
                    year : this.selectYear,
                    group_id : this.group_id
                }
                if (select.group_id == undefined || select.group_id == '') {
                    window.open('./api/report/report4?' + this.genUrl(select));
                    // console.log(this.genUrl(this.select));
                } else {
                    window.open('./api/report/report4_1?' + this.genUrl(select));
                    // console.log(this.genUrl(this.select));
                }
            }

        });
    </script>
</dom-module>