<link rel="import" href="components/welfare-panel.html">
<link rel="import" href="components/welfare-manage.html">
<link rel="import" href="components/welfare-detail.html">

<dom-module id="page-welfare">
    <template>
        <style is="custom-style" include="gl-color gl-table iron-flex iron-flex-factors iron-flex-alignment">
            paper-material {
                background-color: var(--gl-white-color);
            }

            .table-detail {
                margin: auto;
                width: 50%;
                padding: 20px;
            }

            table.gl-table-default {
                border: 1px solid #ddd;
            }
        </style>
        <div class="horizontal end-justified layout">
            <paper-button raised style="margin: 20px" class="gl-btn-primary" on-tap="_insert">
                <iron-icon icon="add"></iron-icon>เพิ่มสวัสดิการ</paper-button>
        </div>
        <div class="container">
            <div class="table-detail">
                <paper-material elevation="1">
                    <table class="gl-table-default">
                        <thead class="table-head">
                            <tr>
                                <th style="text-align: center">ปี</th>
                                <th>ชื่อสวัสดิการ</th>
                                <th style="text-align:center;">เครื่องมือ</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">
                            <template is="dom-repeat" items="{{list}}">
                                <tr style="cursor:pointer;">
                                    <td style="text-align: center" data="[[item]]" on-tap="select_welfare" >[[item.year]]</td>
                                    <td data="[[item]]" on-tap="select_welfare" >[[item.group_welfare_name]]</td>
                                    <td style="width:10%;">
                                        <paper-button data="[[item]]" style="height:30px; width:25px;" raised class="gl-btn-info" on-tap="_edit">แก้ไข</paper-button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </paper-material>
            </div>
        </div>

        <panel-right title="{{title}}">
            <iron-pages selected="{{pages}}">
                <div>
                    <welfare-panel data="{{data}}"></welfare-panel>
                </div>
                <div>
                    <welfare-detail data="{{dataSelect}}"></welfare-detail>
                </div>
                <div>
                    <welfare-manage></welfare-manage>
                </div>
            </iron-pages>
        </panel-right>


    </template>
    <script>
        Polymer({
            is: 'page-welfare',
            behaviors: [ReduxBehavior, nylonBehavior, welfareAction, listWelfareAction],
            properties: {
                list: {
                    statePath: 'welfare.list',
                },
                pages: {
                    type: Number,
                    value: 0
                }
            },
            listeners:
            { 
                'closePanel': 'close_panel' 
            }
            ,
            nylonPageActive: function () {
                // this.dispatchAction('LIST_WELFARE');
                this.LIST_WELFARE();
                this.WELFARE_LIST();
            },
            _insert: function () {
                this.$$('panel-right').open();
                this.pages = 0;
                this.set('title', this.title = "เพิ่มสวัสดิการ");
            },
            select_welfare: function (e) {
                // console.log(e.currentTarget.data);
                this.$$('panel-right').open();
                this.$$('welfare-detail').setPage(0);
                // this.pageDetail = '0';
                this.pages = 1;
                this.set('title', this.title = "ข้อมูลสวัสดิการ");
                this.dataSelect = e.currentTarget.data;
                var id = e.currentTarget.data.id;
                this.LIST_WELFARE_ID(id);
            },
            close_panel: function () {
                this.$$('panel-right').close();
            },
            clearData: function () {
                this.data = {
                    year: '',
                    name: '',
                    condition: []
                };
            },
            _edit:function(e){
                // console.log(e.currentTarget.data);
                var id = e.currentTarget.data.id;
                this.SELECT_DATA(id);
                this.$$('panel-right').open();
                this.pages = 2;
                this.set('title', this.title = "แก้ไข");
            },
         
        });
    </script>
</dom-module>