<link rel="import" href="components/welfare-panel.html">
<!--<link rel="import" href="components/welfare-manage.html">
<link rel="import" href="components/welfare-detail.html">-->
<link rel="import" href="./../components/page-style.html">

<link rel="import" href="./../components/common-logic.html">


<dom-module id="page-admin-welfare">
    <template>
        <style include="page-style iron-flex iron-flex-factors iron-flex-alignment">
            paper-material {
                /*background-color: var(--gl-white-color);*/
                padding: 0px;
            }
            
            * {
                font-family: 'CSChatThaiUI', sans-serif;
                -webkit-font-smoothing: antialiased;
            }
            
            .table-detail {
                margin: auto;
                /*width: 80%;*/
                /*padding: 20px;*/
            }
            
            table.gl-table-default {
                width: 100%;
                border: 1px solid #ddd;
            }
            
            .title-text {
                font-family: 'CSChatThaiUI', sans-serif;
                -webkit-font-smoothing: antialiased;
                font-weight: bold;
                margin-top: 35px;
                font-size: 20px;
            }
        </style>
        <div class="xcontainer">
            <div class="header-page">จัดการสวัสดิการ</div>
            <div class="horizontal layout">
                <!--<paper-button raised style="margin: 20px" class="gl-btn-primary" on-tap="_print">
                <iron-icon icon="print"></iron-icon>ออกรายงาน</paper-button>-->
                <div class="flex horizontal start-justified layout">
                    <gl-form-dropdown-menu label="ปี" placeholder="เลือกปี">
                        <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{selectYear}}">
                            <template is="dom-repeat" items={{list_year}}>
                                <paper-item value="[[item.year]]">[[item.year]]</paper-item>
                            </template>
                        </paper-menu>
                    </gl-form-dropdown-menu>
                </div>
                <div class="flex horizontal end-justified layout">
                    <div class="">
                        <paper-button raised style="margin: 20px" class="gl-btn-primary" on-tap="_insert">
                            <iron-icon icon="add"></iron-icon>เพิ่มสวัสดิการ</paper-button>
                    </div>
                </div>

            </div>
            <div class="container">
                <div class="table-detail">
                    <paper-material elevation="1">
                        <table class="gl-table-default">
                            <thead class="table-head">
                                <tr>
                                    <th style="text-align:center; width:15%;">ปี</th>
                                    <th>ชื่อสวัสดิการ</th>
                                    <th style="text-align:center">จำนวนผู้มีสิทธิ</th>
                                    <th style="text-align:center">จำนวนผู้ใช้สิทธิ</th>
                                    <th style="text-align:center;width:15%;">ยอดเต็ม (บาท)</th>
                                    <th style="text-align:center;width:15%;">ยอดที่ใช้ (บาท)</th>
                                    <th style="width:15%;text-align:center;">เครื่องมือ</th>
                                </tr>
                            </thead>
                            <tbody class="table-body">
                                <template is="dom-repeat" items="{{list}}">
                                    <tr style="cursor:pointer;">
                                        <td style="text-align:center">[[item.year]]</td>
                                        <td>[[item.group_welfare_name]]</td>
                                        <td style="text-align:center">[[item.emp_budget]]</td>
                                        <td style="text-align:center">[[item.emp_use]]</td>
                                        <td style="text-align:right">[[formatNumber(item.value_budget)]]</td>
                                        <td style="text-align:right">[[formatNumber(item.value_use)]]</td>
                                        <td style="text-align:center">
                                            <!--<paper-icon-button data="[[item]]" icon="icons:list" on-tap="select_welfare" title="เงื่อนไข"></paper-icon-button>
                                            <paper-icon-button data="[[item]]" icon="icons:create" on-tap="_edit" title="แก้ไขสวัสดิการ"></paper-icon-button>-->
                                            <paper-icon-button data="[[item]]" icon="icons:create" on-tap="_edit" title="แก้ไขสวัสดิการ"></paper-icon-button>
                                        </td>
                                    </tr>
                                </template>
                                
                                <template is="dom-if" if={{_ObIsHave(list)}}>
                                    <tr>
                                        <td colspan="7"> ไม่มีข้อมูล</td>
                                    </tr>
                                </template>
                                
                            </tbody>
                        </table>
                    </paper-material>
                </div>
            </div>

            <panel-right title="{{title}}">
                <iron-pages selected="{{pages}}">
                    <div>
                        <!--<welfare-panel data="{{data}}"></welfare-panel>-->
                        <welfare-panel is-enable="[[active]]" data-select="{{dataSelect}}"></welfare-panel>
                    </div>
                    <!--<div>
                        <welfare-detail data="{{dataSelect}}"></welfare-detail>
                    </div>
                    <div>
                        <welfare-manage></welfare-manage>
                    </div>-->
                </iron-pages>
            </panel-right>
        </div>

    </template>
    <script>
        Polymer({
            is: 'page-admin-welfare',
            behaviors: [ReduxBehavior, FormatNumberBehavior, nylonBehavior, groupWelfareAction, welfareAction, nylonLocalizeBehavior,commonLogic],
            observers: ['changeYear(selectYear)'],
            properties: {
                list: {
                    statePath: 'groupWelfare.list'
                },
                list_year: {
                    statePath: 'groupWelfare.list_year'
                },
                pages: {
                    type: Number,
                    value: 0
                },
            },
            listeners:
            {
                'closePanel': 'close_panel'
            },
            nylonPageActive: function () {
                let year = new Date().getFullYear();
                // console.log(year);
                var newYear = year + 543;
                this.selectYear = newYear;
                // this.LIST_WELFARE(year);
                this.WELFARE_LIST();
                this.GET_YEAR();
            },
            select_welfare: function (e) {
                // console.log(e.currentTarget.data);
                this.$$('panel-right').open();
                this.$$('welfare-detail').setPage(0);
                // this.pageDetail = '0';
                this.pages = 1;
                this.set('title', this.title = "ข้อมูลสวัสดิการ");
                this.dataSelect = e.currentTarget.data;
                var id = e.currentTarget.data.id;
                this.LIST_WELFARE_ID(id);
            },
            close_panel: function () {
                this.$$('panel-right').close();
            },
            clearData: function () {
                this.data = {
                    year: parseInt(new Date().toISOString().split('-')[0]) + 543,
                    name: '',
                    start_date: new Date().toISOString().split('-')[0] + '-01-01',
                    end_date: new Date().toISOString().split('-')[0] + '-12-31',
                    admin_use: false,
                    onetime: false
                };
            },
            _insert: function () {
                this.$$('panel-right').open();
                this.clearData();
                this.CLEAR_WELFARE(this.data);
                this.CLEAR_WELFARE_ID();
                this.pages = 0;
                this.active = false;
                this.$$('welfare-panel').checked_tab();
                this.dataSelect = [];
            },
            // _edit: function (e) {
            //     // console.log(e.currentTarget.data);
            //     var id = e.currentTarget.data.id;
            //     this.SELECT_DATA(id);
            //     this.$$('panel-right').open();
            //     this.pages = 2;
            //     this.set('title', this.title = "แก้ไข");
            // },
            _edit: function (e) {
                // console.log(e.currentTarget.data);
                this.dataSelect = e.currentTarget.data;
                var id = e.currentTarget.data.id;
                this.SELECT_DATA(id);
                this.LIST_WELFARE_ID(id);
                this.$$('panel-right').open();
                this.pages = 0;
                this.active = true;
                this.$$('welfare-panel').checked_tab();
                // this.$$('welfare-panel').checked_tab();
            },
            changeYear: function (e) {
                var year = e - 543;
                this.LIST_WELFARE(year);
            },
            _print: function () {
                this.fire('nylon-change-page', { path: '/report' })
            }
        });
    </script>
</dom-module>