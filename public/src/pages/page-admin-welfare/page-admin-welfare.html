<link rel="import" href="components/welfare-panel.html">
<link rel="import" href="components/welfare-manage.html">
<link rel="import" href="components/welfare-detail.html">
<link rel="import" href="./../components/page-style.html">

<dom-module id="page-admin-welfare">
    <template>
        <style include="page-style iron-flex iron-flex-factors iron-flex-alignment">
            paper-material {
                /*background-color: var(--gl-white-color);*/
                padding: 0px;
            }
            
            .table-detail {
                margin: auto;
                width: 80%;
                padding: 20px;
            }
            
            table.gl-table-default {
                width: 100%;
                border: 1px solid #ddd;
            }
        </style>
        <div class="horizontal end-justified layout">
            <paper-button raised style="margin: 20px" class="gl-btn-primary" on-tap="_insert">
                <iron-icon icon="add"></iron-icon>เพิ่มสวัสดิการ</paper-button>
        </div>
        <div style="margin-left:140px;">
            <!--<gl-combo-box item-label-path="year" item-value-path="year" items="{{list_year}}" value="{{selectYear}}"></gl-combo-box>-->
            <gl-form-dropdown-menu label="ปี" placeholder="เลือกปี">
                <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{selectYear}}">
                    <template is="dom-repeat" items={{list_year}}>
                        <paper-item value="[[item.year]]">[[item.year]]</paper-item>
                    </template>
                </paper-menu>
            </gl-form-dropdown-menu>
        </div>
        <div class="container">
            <div class="table-detail">
                <paper-material elevation="1">
                    <table class="gl-table-default">
                        <thead class="table-head">
                            <tr>
                                <th style="text-align:center; width:15%;">ปี</th>
                                <th>ชื่อสวัสดิการ</th>
                                <th style="text-align:center">จำนวนผู้มีสิทธิ</th>
                                <th style="text-align:center">จำนวนผู้ใช้สิทธิ</th>
                                <th style="text-align:center;width:15%;">ยอดเต็ม (บาท)</th>
                                <th style="text-align:center;width:15%;">ยอดที่ใช้ (บาท)</th>
                                <th style="width:15%;text-align:center;">เครื่องมือ</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">
                            <template is="dom-repeat" items="{{list}}">
                                <tr style="cursor:pointer;">
                                    <td style="text-align:center">[[item.year]]</td>
                                    <td>[[item.group_welfare_name]]</td>
                                    <td style="text-align:center">[[item.emp_budget]]</td>
                                    <td style="text-align:center">[[item.emp_use]]</td>
                                    <td style="text-align:right">[[formatNumber(item.value_budget)]]</td>
                                    <td style="text-align:right">[[formatNumber(item.value_use)]]</td>
                                    <td style="text-align:center">
                                        <paper-icon-button data="[[item]]" icon="icons:list" on-tap="select_welfare" title="เงื่อนไข"></paper-icon-button>
                                        <paper-icon-button data="[[item]]" icon="icons:create" on-tap="_edit" title="แก้ไขสวัสดิการ"></paper-icon-button>
                                        <!--<paper-button data="[[item]]" style="height:30px; width:25px;" raised class="gl-btn-info">แก้ไข</paper-button>-->
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </paper-material>
            </div>
        </div>

        <panel-right title="{{title}}">
            <iron-pages selected="{{pages}}">
                <div>
                    <welfare-panel data="{{data}}"></welfare-panel>
                </div>
                <div>
                    <welfare-detail data="{{dataSelect}}"></welfare-detail>
                </div>
                <div>
                    <welfare-manage></welfare-manage>
                </div>
            </iron-pages>
        </panel-right>


    </template>
    <script>
        Polymer({
            is: 'page-admin-welfare',
            behaviors: [ReduxBehavior, FormatNumberBehavior, nylonBehavior, groupWelfareAction, welfareAction],
            observers: ['changeYear(selectYear)'],
            properties: {
                list: {
                    statePath: 'groupWelfare.list'
                },
                list_year: {
                    statePath: 'groupWelfare.list_year'
                },
                year: {
                    statePath: 'groupWelfare.year'
                },
                pages: {
                    type: Number,
                    value: 0
                },
            },
            listeners:
            {
                'closePanel': 'close_panel'
            }
            ,
            nylonPageActive: function () {
                let year = new Date().getFullYear();
                // console.log(year);
                var newYear = year + 543;
                this.selectYear = newYear;
                // this.LIST_WELFARE(year);
                this.WELFARE_LIST();
                this.GET_YEAR();
            },
            _insert: function () {
                this.$$('panel-right').open();
                this.pages = 0;
                this.set('title', this.title = "เพิ่มสวัสดิการ");
            },
            select_welfare: function (e) {
                // console.log(e.currentTarget.data);
                this.$$('panel-right').open();
                this.$$('welfare-detail').setPage(0);
                // this.pageDetail = '0';
                this.pages = 1;
                this.set('title', this.title = "ข้อมูลสวัสดิการ");
                this.dataSelect = e.currentTarget.data;
                var id = e.currentTarget.data.id;
                this.LIST_WELFARE_ID(id);
            },
            close_panel: function () {
                this.$$('panel-right').close();
            },
            clearData: function () {
                this.data = {
                    year: '',
                    name: '',
                    condition: []
                };
            },
            _edit: function (e) {
                // console.log(e.currentTarget.data);
                var id = e.currentTarget.data.id;
                this.SELECT_DATA(id);
                this.$$('panel-right').open();
                this.pages = 2;
                this.set('title', this.title = "แก้ไข");
            },
            changeYear: function (e) {
                var year = e - 543;
                this.LIST_WELFARE(year);
            }
        });
    </script>
</dom-module>